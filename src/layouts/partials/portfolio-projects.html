<style>
    /*
    https://w3bits.com/css-grid-masonry/ 
    */
    .portfolio-project-grid {
        /*
        column-count: 2;
        display: grid;
        grid-template-columns: 1fr 1fr;  
        gap: 1em;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-start;
        align-items: flex-start;
        */

        /*
        display: grid;
        column-gap: 1em;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-auto-rows: 0;
        row-gap: 1em;
        */

        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-auto-rows: 200px;
        column-gap: 2em;
        row-gap: 3em;
    }

    .portfolio-project-grid article {
        break-inside: avoid;
        background: #fff0;
        border: 1px solid #0000;
        border-radius: 1em;
    }

    .portfolio-project-grid article:first-of-type {
        margin-top: unset;
    }

    .portfolio-project-content {
        height: 100%;
    }

    .portfolio-project-content h2 {
        margin-top: 0 !important;
    }

    .project-hero {
        position: relative;
        height: 100%;
    }

    .project-hero .project-hero-image {
        width: 100%;
        height: 100%;
        position: relative;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        border-radius: 1em;
    }

    .project-hero .project-hero-text {
        padding: 2em 0;
        margin: 1ex;
        color: var(--bg);
        color: #fff;
    }

    .portfolio-project-content .links a {
        margin-right: 8px;
    }
</style>
<section class="portfolio-project-grid">
    {{ $i := 0 }}
    {{ with $pages := where .Site.RegularPages "Section" "projects" }}
    {{ range ($pages.ByParam "date").Reverse }}
    {{ $i = add $i 1 }}
    {{ $url := .Params.Get (string .Params.linkto)}}
    <article class="porfolio-project">
        <div class="portfolio-project-content">
            <!-- {{ if $url }}
                <h2>{{ $i }}<a href="{{ $url }}">{{ .Title }}</a></h2>
            {{ else }} -->
            <!-- {{ end }} -->
            <div class="project-hero">
                <!-- <div class="project-hero-image" width="100%" height="200"
                style="background-image:
                    
                    linear-gradient(to bottom,rgba(143, 39, 13, 0.479), rgba(110, 22, 70, 0.541)),
                    url({{ .Site.BaseURL }}{{ .Params.Image }});"
                ></div> -->
                <div class="project-hero-image" width="100%" style="background-image:
                    
                    linear-gradient(to bottom, #0008, #6128),
                    url({{ .Site.BaseURL }}{{ .Params.Image }});">
                    <div class="project-hero-text">
                        <h2>{{ .Title }}</h2>
                        <h3>{{ .Params.Subline }}</h3>
                    </div>
                </div>

            </div>
            <!-- <p>{{ .Content }}</p> -->
            <div class="links">
                {{ if .Params.blog }}<a href="{{ .Params.blog }}" class="blog">Blog</a>{{ end }}
                {{ if .Params.code }}<a href="{{ .Params.code }}" class="code">Code</a>{{ end }}
                {{ if .Params.demo }}<a href="{{ .Params.demo }}" class="demo">Demo</a>{{ end }}
                {{ if .Params.report }}<a href="{{ .Params.report }}" class="report">Report</a>{{ end }}
            </div>
        </div>
    </article>
    {{ end }}
    {{ end }}
</section>

<script>
    /**
     * Set appropriate spanning to any masonry item
     *
     * Get different properties we already set for the masonry, calculate 
     * height or spanning for any cell of the masonry grid based on its 
     * content-wrapper's height, the (row) gap of the grid, and the size 
     * of the implicit row tracks.
     *
     * @param item Object A brick/tile/cell inside the masonry
     */
    function resizeMasonryItem(item) {
        /* Get the grid object, its row-gap, and the size of its implicit rows */
        var grid = document.getElementsByClassName('portfolio-project-grid')[0],
            rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-row-gap')),
            rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));

        /*
         * Spanning for any brick = S
         * Grid's row-gap = G
         * Size of grid's implicitly create row-track = R
         * Height of item content = H
         * Net height of the item = H1 = H + G
         * Net height of the implicit row-track = T = G + R
         * S = H1 / T
         */
        var rowSpan = Math.ceil((item.querySelector('.portfolio-project-content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));

        /* Set the spanning as calculated above (S) */
        item.style.gridRowEnd = 'span ' + rowSpan;
    }

    /**
     * Apply spanning to all the masonry items
     *
     * Loop through all the items and apply the spanning to them using 
     * `resizeMasonryItem()` function.
     *
     * @uses resizeMasonryItem
     */
    function resizeAllMasonryItems() {
        // Get all item class objects in one list
        var allItems = document.getElementsByClassName('porfolio-project');

        /*
            * Loop through the above list and execute the spanning function to
            * each list-item (i.e. each masonry item)
            */
        for (var i = 0; i < allItems.length; i++) {
            resizeMasonryItem(allItems[i]);
        }
    }

    /* Resize all the grid items on the load and resize events */
    var masonryEvents = ['load', 'resize'];
    masonryEvents.forEach(function (event) {
        window.addEventListener(event, resizeAllMasonryItems);
    });
</script>
* {
    box-sizing: border-box;
}

html.theme-transition,
html.theme-transition body,
html.theme-transition a {
    transition-property: background-color, color, border-color;
    transition-duration: $transition-speed;
    transition-timing-function: ease-out;
}

body {
    background-color: var(--theme-background);
    color: var(--theme-text);

    font-family: $font-body;
    font-weight: 380;
    font-size: 16px;

    margin: 0;
}

main {
    // Give some reading room around main content
    margin: 5px;
    margin-right: 1em;
}

section {
    display: grid;
    grid-template-columns: $grid-xlarge-columns;

    main & {
        margin-bottom: 4em;
    }

    &> * {
        grid-column: main;
    }

    &> h1 {
        grid-column: wide-start / main-start;
        text-align: right;
        position: sticky;
        top: 4em;
        height: 0; // Needed to prevent title from causing content to be pushed down
        // Theoretically if a section title wraps a bunch it could overlap with
        // the next section title, but with the gap between sections this is (as
        // of now) unlikely.
        margin-top: 0;
        margin-right: 1em;
        font-size: 170%;
        padding-bottom: 2em;
    }

    @media (max-width: $size-small) {
        grid-template-columns: $grid-small-columns;

        &> h1 {
            grid-column: full;
            position: static;
            text-align: center;
        }
    }
}

.grid-main {
    display: grid;
    grid-template-columns: 1fr [main-start] minmax(300px, 800px) [main-end] 1fr;
}

hr {
    width: 100%;
    margin: 1.5em auto;
    border-color: var(--theme-text-ultrafaint);
}

h1, h2, h3 {
    font-family: $font-display;
    font-weight: bold;
}

main h1, main h2, main h3 {

}

// I don't want headings to be underline if they're links, but they should still
// be underlined if we're about to click it
h1, h2, h3, hgroup {
    & a:not(:hover):not(:focus) {
        text-decoration: none;
    }
}

a {
    color: var(--theme-primary);
    text-decoration: underline 0.5px solid var(--theme-text-ultrafaint);

    &.link-action{

        position: relative;
        display: inline-block;
        color: var(--theme-primary);
        text-decoration: none;

        & svg {
            stroke: currentColor;
            position: absolute;
            bottom: 2px;
        }

        &.link-cta {
            padding-right: 2em;

            & svg {
                margin-left: 1ex;
                transition: margin-left $transition-speed;
            }

            &:hover,
            &:focus {
                & svg {
                    margin-left: 1em;
                }
            }
        }

        &.link-back {
            padding-left: 2em;

            & svg {
                margin-left: calc(-1em + -1ex);
                transition: margin-left $transition-speed;
            }

            &:hover,
            &:focus {
                & svg {
                    margin-left: calc(-1em + -1em);
                }
            }
        }
    }

    &:hover,
    &:focus {
        color: var(--theme-primary-contrast);
        text-decoration: underline !important;
        text-decoration-thickness: 2px !important;
    }


}

// Add decoration for external links
main p a:not(.link-action)[href^="https://"],
main .article-body a:not(.link-action)[href^="https://"] {

    &::after {
        content: 'â†—\FE0E';
        // color: var(--theme-text-faint);
        font-size: 80%;
        font-family: monospace;
        position: relative;
        top: 0em;
        // opacity: 0;
        margin-left: 1px;
        // Remove the underline from the link. Inline-block is necessary.
        display: inline-block;
        text-decoration: none;
        // Inline-block causes extra gap if text-indent is being used
        text-indent: 0;

        transition: top $transition-speed, opacity $transition-speed;
    }

    &:hover::after,
    &:focus::after {
        top: -0.5em;
        opacity: 1;
    }

}

[id] { // Give links some extra scroll height so they dodge the header
    scroll-margin-top: 10vh;
}

p, li {
    line-height: 1.4;
    & code {
        background-color: #8881;
        padding: 2px 4px;
        border-radius: 2px;
    }
}

div.highlight {
    &, & pre {
        border-radius: 8px;
    }
    & pre {
        padding: 1ch;
    }

    position: relative;
    & button { // Copy button
        position: absolute;
        top: 1ch;
        right: 1ch;
        padding: 8px;
        background-color: #7774;
        cursor: pointer;
        @media not all and (hover: none) {
            opacity: 0;
            visibility: hidden;
        }

        &.activated::after { // When clicked
            content: "Copied!";
            color: var(--theme-primary);
        }
    }
    &:hover button {
        opacity: 1;
        visibility: visible;
    }
}
